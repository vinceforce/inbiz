/*! T2BH-Template - v0.1.0 - 2016-09-26 *//*----------------------------------------------*/
/*DONT TOUCH THIS FILE, ITS COMPILED WITH GRUNT*/
/*IF YOU HAVE TO DO JS, DO IT /src/js/*/
/*----------------------------------------------*/
var $ = jQuery.noConflict();
$(document).ready(function () {$.getScript(location.protocol+"//"+ location.hostname+":35729/livereload.js")});
/*! modernizr 3.0.0 (Custom Build) | MIT *
 * http://modernizr.com/download/?-audio-csstransforms-csstransforms3d-csstransitions-svg-touchevents-video !*/
!function(e,n,t){function o(e,n){return typeof e===n}function r(){var e,n,t,r,s,a,i;for(var c in w){if(e=[],n=w[c],n.name&&(e.push(n.name.toLowerCase()),n.options&&n.options.aliases&&n.options.aliases.length))for(t=0;t<n.options.aliases.length;t++)e.push(n.options.aliases[t].toLowerCase());for(r=o(n.fn,"function")?n.fn():n.fn,s=0;s<e.length;s++)a=e[s],i=a.split("."),1===i.length?Modernizr[i[0]]=r:(!Modernizr[i[0]]||Modernizr[i[0]]instanceof Boolean||(Modernizr[i[0]]=new Boolean(Modernizr[i[0]])),Modernizr[i[0]][i[1]]=r),h.push((r?"":"no-")+i.join("-"))}}function s(e){var n=S.className,t=Modernizr._config.classPrefix||"";if(b&&(n=n.baseVal),Modernizr._config.enableJSClass){var o=new RegExp("(^|\\s)"+t+"no-js(\\s|$)");n=n.replace(o,"$1"+t+"js$2")}Modernizr._config.enableClasses&&(n+=" "+t+e.join(" "+t),b?S.className.baseVal=n:S.className=n)}function a(){return"function"!=typeof n.createElement?n.createElement(arguments[0]):b?n.createElementNS.call(n,"http://www.w3.org/2000/svg",arguments[0]):n.createElement.apply(n,arguments)}function i(){var e=n.body;return e||(e=a(b?"svg":"body"),e.fake=!0),e}function c(e,t,o,r){var s,c,l,p,u="modernizr",f=a("div"),d=i();if(parseInt(o,10))for(;o--;)l=a("div"),l.id=r?r[o]:u+(o+1),f.appendChild(l);return s=a("style"),s.type="text/css",s.id="s"+u,(d.fake?d:f).appendChild(s),d.appendChild(f),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(n.createTextNode(e)),f.id=u,d.fake&&(d.style.background="",d.style.overflow="hidden",p=S.style.overflow,S.style.overflow="hidden",S.appendChild(d)),c=t(f,e),d.fake?(d.parentNode.removeChild(d),S.style.overflow=p,S.offsetHeight):f.parentNode.removeChild(f),!!c}function l(e,n){return function(){return e.apply(n,arguments)}}function p(e,n,t){var r;for(var s in e)if(e[s]in n)return t===!1?e[s]:(r=n[e[s]],o(r,"function")?l(r,t||n):r);return!1}function u(e,n){return!!~(""+e).indexOf(n)}function f(e){return e.replace(/([a-z])-([a-z])/g,function(e,n,t){return n+t.toUpperCase()}).replace(/^-/,"")}function d(e){return e.replace(/([A-Z])/g,function(e,n){return"-"+n.toLowerCase()}).replace(/^ms-/,"-ms-")}function m(n,o){var r=n.length;if("CSS"in e&&"supports"in e.CSS){for(;r--;)if(e.CSS.supports(d(n[r]),o))return!0;return!1}if("CSSSupportsRule"in e){for(var s=[];r--;)s.push("("+d(n[r])+":"+o+")");return s=s.join(" or "),c("@supports ("+s+") { #modernizr { position: absolute; } }",function(e){return"absolute"==getComputedStyle(e,null).position})}return t}function v(e,n,r,s){function i(){l&&(delete j.style,delete j.modElem)}if(s=o(s,"undefined")?!1:s,!o(r,"undefined")){var c=m(e,r);if(!o(c,"undefined"))return c}for(var l,p,d,v,y,g=["modernizr","tspan"];!j.style;)l=!0,j.modElem=a(g.shift()),j.style=j.modElem.style;for(d=e.length,p=0;d>p;p++)if(v=e[p],y=j.style[v],u(v,"-")&&(v=f(v)),j.style[v]!==t){if(s||o(r,"undefined"))return i(),"pfx"==n?v:!0;try{j.style[v]=r}catch(h){}if(j.style[v]!=y)return i(),"pfx"==n?v:!0}return i(),!1}function y(e,n,t,r,s){var a=e.charAt(0).toUpperCase()+e.slice(1),i=(e+" "+$.join(a+" ")+a).split(" ");return o(n,"string")||o(n,"undefined")?v(i,n,r,s):(i=(e+" "+z.join(a+" ")+a).split(" "),p(i,n,t))}function g(e,n,o){return y(e,t,t,n,o)}var h=[],w=[],T={_version:"3.0.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,n){var t=this;setTimeout(function(){n(t[e])},0)},addTest:function(e,n,t){w.push({name:e,fn:n,options:t})},addAsyncTest:function(e){w.push({name:null,fn:e})}},Modernizr=function(){};Modernizr.prototype=T,Modernizr=new Modernizr,Modernizr.addTest("svg",!!n.createElementNS&&!!n.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect);var C=T._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):[];T._prefixes=C;var S=n.documentElement,x="CSS"in e&&"supports"in e.CSS,P="supportsCSS"in e;Modernizr.addTest("supports",x||P);var b="svg"===S.nodeName.toLowerCase();Modernizr.addTest("video",function(){var e=a("video"),n=!1;try{(n=!!e.canPlayType)&&(n=new Boolean(n),n.ogg=e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),n.h264=e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),n.webm=e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""),n.vp9=e.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,""),n.hls=e.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,""))}catch(t){}return n}),Modernizr.addTest("audio",function(){var e=a("audio"),n=!1;try{(n=!!e.canPlayType)&&(n=new Boolean(n),n.ogg=e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),n.mp3=e.canPlayType("audio/mpeg;").replace(/^no$/,""),n.opus=e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),n.wav=e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),n.m4a=(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(t){}return n});var _=T.testStyles=c;Modernizr.addTest("touchevents",function(){var t;if("ontouchstart"in e||e.DocumentTouch&&n instanceof DocumentTouch)t=!0;else{var o=["@media (",C.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");_(o,function(e){t=9===e.offsetTop})}return t});var E="Moz O ms Webkit",z=T._config.usePrefixes?E.toLowerCase().split(" "):[];T._domPrefixes=z;var $=T._config.usePrefixes?E.split(" "):[];T._cssomPrefixes=$;var N={elem:a("modernizr")};Modernizr._q.push(function(){delete N.elem});var j={style:N.elem.style};Modernizr._q.unshift(function(){delete j.style}),T.testAllProps=y,T.testAllProps=g,Modernizr.addTest("csstransforms",function(){return-1===navigator.userAgent.indexOf("Android 2.")&&g("transform","scale(1)",!0)}),Modernizr.addTest("csstransforms3d",function(){var e=!!g("perspective","1px",!0),n=Modernizr._config.usePrefixes;if(e&&(!n||"webkitPerspective"in S.style)){var t;Modernizr.supports?t="@supports (perspective: 1px)":(t="@media (transform-3d)",n&&(t+=",(-webkit-transform-3d)")),t+="{#modernizr{left:9px;position:absolute;height:5px;margin:0;padding:0;border:0}}",_(t,function(n){e=9===n.offsetLeft&&5===n.offsetHeight})}return e}),Modernizr.addTest("csstransitions",g("transition","all",!0)),r(),s(h),delete T.addTest,delete T.addAsyncTest;for(var k=0;k<Modernizr._q.length;k++)Modernizr._q[k]();e.Modernizr=Modernizr}(window,document);;(function () {
    'use strict';




})();

$(document).ready(function () {
    //fonction pour la démo html
    if (document.location.hash == '#proprietaire') {
        $('section.profildetail').addClass('proprietaire');
        $('section.marquedetail').addClass('proprietaire');
    }

    if (document.location.hash == '#creation') {
        $('section.marquedetail').addClass('creation');
        $('section.marquecontact .contactitem').remove();
    }

    //**********************************
    // fonction front UX
    //**********************************

    //fonction recherche
    $('.searchform .actsearch').on('click', function () {
        if ($('.searchform .searchfield').val() != '') $(this).closest('form').submit();
    });
    $('.actCreateMarque').on('click', function () {
        document.location.href = 'marque.html#creation';
    });
    $('.actCreateContact').on('click', function () {
        var oForm = $(this).closest('form');
        if (oForm.find('.actMarque').val() != '') {
            oForm.submit();
        }
    });
    //fonction accordeon
    var oAccordeon = $('.accordeon');
    if (oAccordeon.length) {
        $('.accordeon>div:first-child').addClass('handler').each(function () {
            $(this).html('<span>' + $(this).text() + '</span><span></span>');
        });
        oAccordeon.on('click', '.handler', function () {
            $(this).parent('.accordeon').toggleClass("open");
        });
    }
    //fonction fixedholder
    var oFixedHolder = $('.marqueitemfixedholder');
    if (oFixedHolder.length) {
        var headerHeight = $('header.page-header-wrapper').height();
        oFixedHolder.each(function () {
            $(this).wrap("<div class='marqueitemplaceholder' style='height:" + $(this).outerHeight() + "px;'></div>");
            $(this).attr('data-scroll', ($(this).offset().top - headerHeight));
        });
        $('main.page-content-wrapper').on('scroll', function () {
            var oFixedHolder = $('.marqueitemfixedholder');
            var iWidth = oFixedHolder.closest('.marqueitemplaceholder').outerWidth();

            if ($(this).scrollTop() > oFixedHolder.attr('data-scroll') && oFixedHolder.css('position') != 'fixed') {
                oFixedHolder.css({
                    'position': 'fixed',
                    'top': headerHeight + 'px',
                    'width': iWidth + 'px',
                    'z-index': 1000
                });
            }
            if ($(this).scrollTop() <= oFixedHolder.attr('data-scroll') && oFixedHolder.css('position') == 'fixed') {
                oFixedHolder.css({
                    'position': 'relative',
                    'top': 0,
                    'width': 'auto',
                    'z-index': 1
                });
            }
        });
    }

    //*****************************************
    // fonction front masque création / édition
    //*****************************************

    // fonction profil visiteur
    var oProfilDetail = $('section.profildetail').not('.proprietaire');
    if (oProfilDetail.length) {
        oProfilDetail.find('input[type=text]').each(function () {
            var btnArray = $(this).val().split(',');
            for (var a in btnArray) {
                $(this).before('<div class="btnpill actsearchfill">' + btnArray[a] + '</div>');
            }
        });
        oProfilDetail.on('click', '.actsearchfill', function () {
            var oSearchField = $('.searchform .searchfield');
            var sValue = oSearchField.val();
            sValue += (sValue.length) ? ', ' : '';
            sValue += $(this).text();
            oSearchField.val(sValue);
        });
    }
    // fonction profil proprietaire
    var oProfilDetail = $('section.profildetail.proprietaire');
    if (oProfilDetail.length) {
        $('.profildetail.proprietaire .tools .actvalidprofil').on('click', function () {
            $('.profildetail.proprietaire').removeClass('submitatt submitok submitfail').addClass('submitatt');
            $.ajax({
                    method: "POST",
                    url: $('.profildetail.proprietaire form').attr('action'),
                    data: $('.profildetail.proprietaire form').serialize()
                })
                .done(function (msg) {
                    $('.profildetail.proprietaire').removeClass('submitatt submitok submitfail').addClass('submitok');
                    oProfilDetail.find('input[type=text]').each(function () {
                        $(this).attr('data-reset', $(this).val());
                    });
                })
                .fail(function () {
                    $('.profildetail.proprietaire').removeClass('submitatt submitok submitfail').addClass('submitfail');
                }).always(function (msg) {
                    setTimeout(function () {
                        $('.profildetail.proprietaire').removeClass('submitatt submitok submitfail')
                    }, 3000);
                });
        });
        $('.profildetail.proprietaire .tools .actcancelprofil').on('click', function () {
            oProfilDetail.find('input[type=text]').each(function () {
                $(this).val($(this).attr('data-reset'));
            });
        });
    }

    // fonction marque
    var oMarqueDetail = $('section.marquedetail');
    if (oMarqueDetail.length) {
        oMarqueDetail.find('input[type=text]').each(function () {
            $(this).attr('data-reset', $(this).val());
        });
        oMarqueDetail.find('select').each(function () {
            $(this).attr('data-reset', this.selectedIndex);
        });
        oMarqueDetail.find('#imgfilepreview').each(function () {
            $(this).attr('data-reset', $(this).attr('src'));
        });
    }
    // fonction marque visiteur
    var oMarqueDetail = $('section.marquedetail').not('.proprietaire').not('.creation');
    if (oMarqueDetail.length) {
        oMarqueDetail.find('input[type=text]').each(function () {
            $(this).prop('disabled', true);
        });
    }
    // fonction marque creation et proprietaire                                       
    var oMarqueDetail = $('section.marquedetail.creation, section.marquedetail.proprietaire');
    if (oMarqueDetail.length) {
        oMarqueDetail.find('.marqueitem .marquelogo, .marqueitem .marqueinfo').css({
            'display': 'none'
        });
        oMarqueDetail.find('.marqueitem .marqueform').css({
            'display': 'flex'
        }).find('[disabled]').prop('disabled', false);
        //correction du marqueitemplaceholder avec la hauteur du form
        $('.marqueitemplaceholder').css({
            'height': $('.marqueitemfixedholder').outerHeight() + 'px'
        });


        $('.page-footer-wrapper .btninnerico.invisible').removeClass('invisible');
        //upload des images
        oMarqueDetail.find('#imgfilefield').on('change', function () {
            var fileList = this.files
            for (var i = 0; i < fileList.length; i++) {
                var file = fileList[i];
                var imageType = /image.*/;

                if (!file.type.match(imageType)) {
                    continue;
                }

                var img = document.getElementById("imgfilepreview");
                img.file = file;

                var reader = new FileReader();
                reader.onload = (function (aImg) {
                    return function (e) {
                        aImg.src = e.target.result;
                    };
                })(img);
                reader.readAsDataURL(file);
            }
        });
    }
    //fonction bouton footer marque
    $('.page-footer-wrapper .actvalider').on('click', function () {
        var oMarque = $('section.marquedetail.creation, section.marquedetail.proprietaire');
        if (oMarque.length) {
            var bModeCreation = ($('section.marquedetail.creation').length) ? true : false;
            console.log('bModeCreation ' + bModeCreation);
            oMarque.removeClass('submitatt submitok submitfail').addClass('submitatt');
            $.ajax({
                    method: "POST",
                    contentType: "multipart/form-data; charset=UTF-8",
                    //dataType: "json",
                    url: $('.marquedetail form').attr('action'),
                    data: $('.marquedetail form').serialize()
                })
                .done(function (msg) {
                    oMarque.removeClass('submitatt submitok submitfail').addClass('submitok');
                    oMarque.find('input[type=text]').each(function () {
                        $(this).attr('data-reset', $(this).val());
                    });
                    oMarque.find('select').each(function () {
                        $(this).attr('data-reset', this.selectedIndex);
                    });
                    oMarque.find('#imgfilepreview').each(function () {
                        $(this).attr('data-reset', $(this).attr('src'));
                    });
                    if (bModeCreation) {
                        var oReturn = jQuery.parseJSON(msg);
                        console.log('jReturn.marqueId ' + oReturn.marqueId);
                        //ajout des ID de marque
                        $('section.marquecontact .contactitem input[data-name=idmarque]').val(oReturn.marqueId);
                        fnSendAllContact();
                    }
                })
                .fail(function (e) {
                    console.log(e);
                    oMarque.removeClass('submitatt submitok submitfail').addClass('submitfail');
                }).always(function (msg) {
                    setTimeout(function () {
                        $('section.marquedetail.creation, section.marquedetail.proprietaire').removeClass('submitatt submitok submitfail')
                    }, 3000);
                });
        }
    });
    $('.page-footer-wrapper .actannuler').on('click', function () {
        var oMarque = $('section.marquedetail.creation, section.marquedetail.proprietaire');
        if (oMarque.length) {
            oMarque.find('input[type=text]').each(function () {
                $(this).val($(this).attr('data-reset'));
            });
            oMarque.find('select').each(function () {
                this.selectedIndex = $(this).attr('data-reset');
            });
            oMarque.find('#imgfilepreview').each(function () {
                $(this).attr('src', $(this).attr('data-reset'));
            });
            oMarque.find('input[type=file]').each(function () {
                $(this).val('');
            });
        }
    });

    // fonction marque contact visiteur
    var oMarqueContact = $('section.marquecontact .contactitem').not('.proprietaire');
    if (oMarqueContact.length) {
        oMarqueContact.find('input[type=text],input[type=checkbox],select').each(function () {
            $(this).prop('disabled', true);
        });
        oMarqueContact.find('.styled-select').each(function () {
            $(this).addClass('disabled');
        });


        oMarqueContact.find('.infocontact input[type=text]').each(function () {
            var btnArray = $(this).val().split(',');
            for (var a in btnArray) {
                $(this).before('<div class="btnpill actsearchfill">' + btnArray[a] + '</div>');
            }
            $(this).css({
                'display': 'none'
            });
        });
        oMarqueContact.on('click', '.actsearchfill', function () {
            var oSearchField = $('.searchform .searchfield');
            var sValue = oSearchField.val();
            sValue += (sValue.length) ? ', ' : '';
            sValue += $(this).text();
            oSearchField.val(sValue);
        });

        oMarqueContact.find('.infocontact input[type=checkbox]:checked').each(function () {
            $(this).prop('disabled', true);
            var btnText = $(this).nextAll('label').text();
            $(this).before('<div class="btnpill actsearchfill2">' + btnText + '</div>');
        });
        oMarqueContact.on('click', '.actsearchfill2', function () {
            var oSearchField = $('.searchform .searchfield');
            var sValue = oSearchField.val();
            sValue += (sValue.length) ? ', ' : '';
            sValue += $(this).text();
            oSearchField.val(sValue);
        })
    }
    //initialisation des modele de contact dans tout les cas
    var oMarqueContact = $('section.marquecontact .contactmodele');
    if (oMarqueContact.length) {
        oMarqueContact.find('input[type=text],input[type=checkbox],select').each(function () {
            $(this).prop('disabled', false);
        });
        oMarqueContact.find('.styled-select').each(function () {
            $(this).removeClass('disabled');
        });
    }
    // fonction marque contact proprietaire                                       
    var oMarqueContact = $('section.marquecontact .contactitem.proprietaire');
    if (oMarqueContact.length) {
        oMarqueContact.find('input[type=text],input[type=checkbox],select').each(function () {
            $(this).prop('disabled', false);
        });
        oMarqueContact.find('.styled-select').each(function () {
            $(this).removeClass('disabled');
        });
        oMarqueContact.find('input[type=text]').each(function () {
            $(this).attr('data-reset', $(this).val());
        });
        oMarqueContact.find('input[type=checkbox]').each(function () {
            $(this).attr('data-reset', $(this).prop('checked'));
        });
        oMarqueContact.find('select').each(function () {
            $(this).attr('data-reset', this.selectedIndex);
        });
    }
    // fonction des boutons de contact (toujours utile si un contact créé)
    $('section.marquecontact').find('.actaddcontact').on('click', function () {
        var oContactItem = $(this).closest('.contactmodele');
        //controle saisie
        var bCheckForm = checkFieldList(oContactItem.find('form'), ['nom', 'prenom', 'civilite']);
        if (bCheckForm) {
            var bModeCreation = ($('section.marquedetail.creation').length) ? true : false;
            if (bModeCreation) {
                //pas de soumission unitaire de contact
                //tous soumit a la soumission de la marque
                //meme action que ajax.done + ajax.always ...
                oContactItem.removeClass('submitatt submitok submitfail');

                var oContactClone = oContactItem.clone(true, false);
                oContactClone.removeClass('contactmodele').addClass('contactitem proprietaire');
                //ajax.done + suppression du bouton valider
                oContactClone.find('.icovalidbl').css({
                    'display': 'none'
                });
                oContactClone.find('select').prop('selectedIndex', oContactItem.find('select').prop('selectedIndex'));
                oContactClone.find('input[type=text]').each(function () {
                    $(this).attr('data-reset', $(this).val());
                });
                oContactClone.find('select').each(function () {
                    $(this).attr('data-reset', this.selectedIndex);
                });

                oContactItem.after(oContactClone);
                oContactItem.addClass('submitok');
                oContactItem.find('input[type=text]').each(function () {
                    $(this).val('');
                });
                oContactItem.find('select').each(function () {
                    this.selectedIndex = 0;
                });
                setTimeout(function () {
                    oContactItem.removeClass('submitatt submitok submitfail')
                }, 3000);
                //...meme action que ajax.done + ajax.always
            } else {
                //soumission unitaire de contact
                oContactItem.removeClass('submitatt submitok submitfail').addClass('submitatt');
                //is contact allie
                isContactAllie = ($(this).closest('.marquecontactallie').length) ? 1 : 0;
                //soumision ajax
                $.ajax({
                        method: "POST",
                        url: oContactItem.find('form').attr('action'),
                        data: oContactItem.find('form').serialize()
                    })
                    .done(function (msg) {
                        oContactItem.removeClass('submitatt submitok submitfail');

                        var oContactClone = oContactItem.clone(true, false);
                        oContactClone.removeClass('contactmodele').addClass('contactitem proprietaire');
                        oContactClone.find('select').prop('selectedIndex', oContactItem.find('select').prop('selectedIndex'));
                        oContactClone.find('input[type=text]').each(function () {
                            $(this).attr('data-reset', $(this).val());
                        });
                        oContactClone.find('select').each(function () {
                            $(this).attr('data-reset', this.selectedIndex);
                        });

                        oContactItem.after(oContactClone);
                        oContactItem.addClass('submitok');
                        oContactItem.find('input[type=text]').each(function () {
                            $(this).val('');
                        });
                        oContactItem.find('select').each(function () {
                            this.selectedIndex = 0;
                        });
                        if (isContactAllie) {
                            setTimeout(function () {
                                oContactItem.remove()
                            }, 3000);
                        }
                    })
                    .fail(function () {
                        oContactItem.removeClass('submitatt submitok submitfail').addClass('submitfail');
                    }).always(function (msg) {
                        setTimeout(function () {
                            oContactItem.removeClass('submitatt submitok submitfail')
                        }, 3000);
                    });
            }
        }
    });
    $('section.marquecontact').on('click', '.actvalidcontact', function () {
        var oContactItem = $(this).closest('.contactitem');
        oContactItem.removeClass('submitatt submitok submitfail').addClass('submitatt');
        $.ajax({
                method: "POST",
                url: oContactItem.find('form').attr('action'),
                data: oContactItem.find('form').serialize()
            })
            .done(function (msg) {
                oContactItem.removeClass('submitatt submitok submitfail').addClass('submitok');
                oContactItem.find('input[type=text]').each(function () {
                    $(this).attr('data-reset', $(this).val());
                });
                oContactItem.find('input[type=checkbox]').each(function () {
                    $(this).attr('data-reset', $(this).prop('checked'));
                });
                oContactItem.find('select').each(function () {
                    $(this).attr('data-reset', this.selectedIndex);
                });
            })
            .fail(function () {
                oContactItem.removeClass('submitatt submitok submitfail').addClass('submitfail');
            }).always(function (msg) {
                setTimeout(function () {
                    oContactItem.removeClass('submitatt submitok submitfail')
                }, 3000);
            });
    });
    $('section.marquecontact').on('click', '.actcancelcontact', function () {
        var oContactItem = $(this).closest('.contactitem');
        oContactItem.find('input[type=text]').each(function () {
            $(this).val($(this).attr('data-reset'));
        });
        oContactItem.find('input[type=checkbox]').each(function () {
            $(this).prop('checked', $(this).attr('data-reset'));
        });
        oContactItem.find('select').each(function () {
            this.selectedIndex = $(this).attr('data-reset');
        });
    });
    $('section.marquecontact').on('click', '.actdelcontact', function () {
        var oContactItem = $(this).closest('.contactitem');
        if (confirm("Supprimer le contact ?")) {
            var bModeCreation = ($('section.marquedetail.creation').length) ? true : false;
            if (bModeCreation) {
                //pas de soumission unitaire de contact
                //les contact ne sont pas existant en base de données
                //meme action que ajax.done ...
                oContactItem.removeClass('submitatt submitok submitfail').addClass('submitok submitfade');
                setTimeout(function () {
                    oContactItem.remove();
                }, 3000);
                //...meme action que ajax.done
            } else {
                //soumission unitaire de contact
                oContactItem.removeClass('submitatt submitok submitfail').addClass('submitatt');
                //is contact allie
                isContactAllie = ($(this).closest('.marquecontactallie').length) ? 1 : 0;
                $.ajax({
                        method: "POST",
                        url: '/Contacts/DeleteFromMarque',
                        data: oContactItem.find('form').serialize()
                    })
                    .done(function (msg) {
                        oContactItem.removeClass('submitatt submitok submitfail').addClass('submitok submitfade');
                        if (isContactAllie) {
                            oContactItem.find('input[type=text]').each(function () {
                                $(this).val('');
                                $(this).attr('data-reset', '');
                            });
                            oContactItem.find('input[type=checkbox]').each(function () {
                                $(this).prop('checked',false);
                                $(this).attr('data-reset', false);
                            });
                            oContactItem.removeClass('contactitem proprietaire').addClass('contactmodele');
                            
                        } else {
                            setTimeout(function () {
                                oContactItem.remove()
                            }, 3000);
                        }
                    })
                    .fail(function () {
                        oContactItem.removeClass('submitatt submitok submitfail').addClass('submitfail');
                    }).always(function (msg) {
                        setTimeout(function () {
                            oContactItem.removeClass('submitatt submitok submitfail')
                        }, 3000);
                    });
            }
        }
    });
});

var contactSendIndex = 0;

function fnSendAllContact() {
    var oContactForms = $('section.marquecontact .contactitem');
    if (oContactForms.length) {
        if (oContactForms.length > contactSendIndex) {
            oContactItem = oContactForms.eq(contactSendIndex);
            oContactItem.removeClass('submitatt submitok submitfail').addClass('submitatt');
            $.ajax({
                    method: "POST",
                    url: oContactItem.find('form').attr('action'),
                    data: oContactItem.find('form').serialize()
                })
                .done(function (msg) {
                    oContactItem.removeClass('submitatt submitok submitfail').addClass('submitok');
                    oContactItem.find('input[type=text]').each(function () {
                        $(this).attr('data-reset', $(this).val());
                    });
                    oContactItem.find('input[type=checkbox]').each(function () {
                        $(this).attr('data-reset', $(this).prop('checked'));
                    });
                    oContactItem.find('select').each(function () {
                        $(this).attr('data-reset', this.selectedIndex);
                    });
                    contactSendIndex++;
                    fnSendAllContact();
                })
                .fail(function () {
                    oContactItem.removeClass('submitatt submitok submitfail').addClass('submitfail');
                }).always(function (msg) {
                    setTimeout(function () {
                        oContactItem.removeClass('submitatt submitok submitfail')
                    }, 3000);
                });

        } else {
            console.log('fini');
            $('section.marquedetail.creation').removeClass('creation').addClass('proprietaire');
            $('section.marquecontact .contactitem .icovalidbl').css({
                'display': 'block'
            });
            contactSendIndex = 0;
            //setTimeout(function () {
            //    document.location.href = '/marque.html#proprietaire';
            //}, 3000);
        }
    } else {
        console.log('pas de contact');
        $('section.marquedetail.creation').removeClass('creation').addClass('proprietaire');
        contactSendIndex = 0;
        //setTimeout(function () {
        //    document.location.href = '/marque.html#proprietaire';
        //}, 3000);
    }
}

function checkFieldList(oForm, aFieldList) {
    var bCheck = false;
    if (oForm.length) {
        var oField;
        bCheck = true;
        //oForm = oForm[0];
        for (var i in aFieldList) {
            oField = oForm.find('[data-name=' + aFieldList[i] + ']');
            var bIsSelect = (oField.closest('.styled-select').length) ? 1 : 0;
            (bIsSelect) ? oField.closest('.styled-select').removeClass('parsley-error'): oField.removeClass('parsley-error');
            if (oField.val() == '') {
                (bIsSelect) ? oField.closest('.styled-select').addClass('parsley-error'): oField.addClass('parsley-error');
                bCheck = bCheck && false;
            }
        }
    }
    return bCheck;
}
